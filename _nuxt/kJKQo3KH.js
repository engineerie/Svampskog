const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B9rKIRhJ.js","./Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as yt,A as Ut,V as q,d as Q,e as Z,M as Zt,f as ae,h as F,aB as ht,n as ne,g as ge,aO as Gt,aW as gt,aT as Te,w as xe,ah as _e,t as fe,aV as Kt,r as R,o as J,aD as Je,aE as Qe,bq as Xt,J as z,aS as Yt,K as Jt,b as $e,q as et}from"#entry";import{c as pe,g as Qt}from"./Cpj98o6Y.js";import{u as bt,a as $t,t as er}from"./t4MXDxpo.js";import"./BU7ip5i4.js";import"./i4TTljSo.js";import"./BaATwz3V.js";import"./DtvcRUba.js";import"./hg6Rz1vw.js";import"./CkLhoWVU.js";import"./CkvY898q.js";import"./D6IImPH9.js";import"./iik6CYzq.js";import"./BDwUQ2Se.js";import"./BSYi5FiS.js";import"./DNP0ZW8r.js";import"./B8AKx5ql.js";import"./DihUQk55.js";var Ae,tt;function wt(){if(tt)return Ae;tt=1;function r(c){var u=typeof c;return c!=null&&(u=="object"||u=="function")}return Ae=r,Ae}var Me,rt;function tr(){if(rt)return Me;rt=1;var r=typeof pe=="object"&&pe&&pe.Object===Object&&pe;return Me=r,Me}var Ce,at;function xt(){if(at)return Ce;at=1;var r=tr(),c=typeof self=="object"&&self&&self.Object===Object&&self,u=r||c||Function("return this")();return Ce=u,Ce}var Oe,nt;function rr(){if(nt)return Oe;nt=1;var r=xt(),c=function(){return r.Date.now()};return Oe=c,Oe}var ze,it;function ar(){if(it)return ze;it=1;var r=/\s/;function c(u){for(var f=u.length;f--&&r.test(u.charAt(f)););return f}return ze=c,ze}var Re,ot;function nr(){if(ot)return Re;ot=1;var r=ar(),c=/^\s+/;function u(f){return f&&f.slice(0,r(f)+1).replace(c,"")}return Re=u,Re}var Ie,lt;function pt(){if(lt)return Ie;lt=1;var r=xt(),c=r.Symbol;return Ie=c,Ie}var je,st;function ir(){if(st)return je;st=1;var r=pt(),c=Object.prototype,u=c.hasOwnProperty,f=c.toString,x=r?r.toStringTag:void 0;function S(M){var C=u.call(M,x),w=M[x];try{M[x]=void 0;var h=!0}catch{}var I=f.call(M);return h&&(C?M[x]=w:delete M[x]),I}return je=S,je}var Fe,ct;function or(){if(ct)return Fe;ct=1;var r=Object.prototype,c=r.toString;function u(f){return c.call(f)}return Fe=u,Fe}var Ee,ut;function lr(){if(ut)return Ee;ut=1;var r=pt(),c=ir(),u=or(),f="[object Null]",x="[object Undefined]",S=r?r.toStringTag:void 0;function M(C){return C==null?C===void 0?x:f:S&&S in Object(C)?c(C):u(C)}return Ee=M,Ee}var Ve,dt;function sr(){if(dt)return Ve;dt=1;function r(c){return c!=null&&typeof c=="object"}return Ve=r,Ve}var qe,ft;function cr(){if(ft)return qe;ft=1;var r=lr(),c=sr(),u="[object Symbol]";function f(x){return typeof x=="symbol"||c(x)&&r(x)==u}return qe=f,qe}var Ne,vt;function ur(){if(vt)return Ne;vt=1;var r=nr(),c=wt(),u=cr(),f=NaN,x=/^[-+]0x[0-9a-f]+$/i,S=/^0b[01]+$/i,M=/^0o[0-7]+$/i,C=parseInt;function w(h){if(typeof h=="number")return h;if(u(h))return f;if(c(h)){var I=typeof h.valueOf=="function"?h.valueOf():h;h=c(I)?I+"":I}if(typeof h!="string")return h===0?h:+h;h=r(h);var j=S.test(h);return j||M.test(h)?C(h.slice(2),j?2:8):x.test(h)?f:+h}return Ne=w,Ne}var Le,mt;function dr(){if(mt)return Le;mt=1;var r=wt(),c=rr(),u=ur(),f="Expected a function",x=Math.max,S=Math.min;function M(C,w,h){var I,j,ie,V,n,N,p=0,L=!1,$=!1,B=!0;if(typeof C!="function")throw new TypeError(f);w=u(w)||0,r(h)&&(L=!!h.leading,$="maxWait"in h,ie=$?x(u(h.maxWait)||0,w):ie,B="trailing"in h?!!h.trailing:B);function ve(_){var D=I,v=j;return I=j=void 0,p=_,V=C.apply(v,D),V}function T(_){return p=_,n=setTimeout(oe,w),L?ve(_):V}function e(_){var D=_-N,v=_-p,ee=w-D;return $?S(ee,ie-v):ee}function W(_){var D=_-N,v=_-p;return N===void 0||D>=w||D<0||$&&v>=ie}function oe(){var _=c();if(W(_))return me(_);n=setTimeout(oe,e(_))}function me(_){return n=void 0,B&&I?ve(_):(I=j=void 0,V)}function le(){n!==void 0&&clearTimeout(n),p=0,I=N=j=n=void 0}function H(){return n===void 0?V:me(c())}function P(){var _=c(),D=W(_);if(I=arguments,j=this,N=_,D){if(n===void 0)return T(N);if($)return clearTimeout(n),n=setTimeout(oe,w),ve(N)}return n===void 0&&(n=setTimeout(oe,w)),V}return P.cancel=le,P.flush=H,P}return Le=M,Le}var fr=dr();const vr=Qt(fr),mr={};function yr(r,c){return null}const hr=Object.assign(yt(mr,[["render",yr]]),{__name:"AnnotationPopup"}),gr={class:"w-full flex justify-center z-30"},br=Ut({__name:"AnnotationMarker",props:{annotation:{}},setup(r){const c=r,u=bt(),f=q(()=>u.selectedAnnotation?.id===c.annotation.id);function x(){u.setSelectedAnnotation(c.annotation)}return(S,M)=>{const C=ht,w=Gt;return Z(),Q("div",{class:"cursor-pointer",onClick:x},[f.value?(Z(),Zt(C,{key:0,label:S.annotation.title,color:"neutral",class:"bg-neutral-800/20 backdrop-blur-2xl"},null,8,["label"])):ae("",!0),F("div",gr,[F("div",{class:ne(["relative transition-all",(f.value,"size-8")])},[ge(w,{name:S.annotation.icon,class:ne(["absolute transition-all z-8",f.value?"size-8 text-green-500":"size-8 text-"+S.annotation.color])},null,8,["name","class"]),ge(w,{name:S.annotation.iconOutline,class:ne(["absolute transition-all z-20",(f.value,"size-8 text-white")])},null,8,["name","class"])],2)])])}}}),wr=Object.assign(br,{__name:"AnnotationMarker"}),xr=gt("panel",{state:()=>({isPanelMinimized:!1}),actions:{togglePanel(){this.isPanelMinimized=!this.isPanelMinimized},setPanelMinimized(r){this.isPanelMinimized=r}}}),pr=gt("viewer",{state:()=>({zoom:1.2,center:{x:.5,y:.3}}),actions:{setViewport(r,c){this.zoom=r,this.center=c}}}),kr={name:"OpenSeadragonViewer",emits:["annotationClicked","viewportChanged","opened","retentionTreeAdded"],props:{currentFramework:{type:Object,required:!0},currentTime:{type:String,required:!0},currentStartskog:{type:Object,required:!0},retentionVisible:{type:Boolean,default:!1},fullscreenLayout:{type:Boolean,default:!1},comparisonMode:{type:Boolean,default:!1},frameworkLabel:{type:String,default:""},timeLabel:{type:String,default:""},layoutMode:{type:String,default:"slider"},globalOpacity:{type:Number,default:void 0},sliderPosition:{type:String,default:"left"},dziUrl:{type:String,required:!0},allowPan:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#544336"},annotations:{type:Array,default:()=>[]},overlayDziUrl:{type:String,default:null},kanteffektVisible:{type:Boolean,default:!1},oldKanteffektVisible:{type:Boolean,default:!0},rottackeVisible:{type:Boolean,default:!1},seedTreeVisible:{type:Boolean,default:!1},devSaveClicks:{type:Boolean,default:!1},smaplantorVisible:{type:Boolean,default:!1},hogstubbarVisible:{type:Boolean,default:!1},naturvardsarterVisible:{type:Boolean,default:!1},tradplantorVisible:{type:Boolean,default:!1}},setup(r,{emit:c,expose:u}){const f=R([]);J(async()=>{try{const t=await(await fetch("/naturvard.json")).json();f.value=Array.isArray(t?.mycelium)?t.mycelium:Array.isArray(t)?t:[]}catch(a){console.error("Failed fetching naturvårdsarter points:",a)}});const x=R([]),S=R([]);J(async()=>{try{const t=await(await fetch("/retentionTrees.json")).json();x.value=t.trees||[]}catch(a){console.error("Failed fetching public retentionTrees:",a)}});const M=R([]),C=R([]);Je("svampar-skogsbruk",()=>Qe("svamparSkogsbruk").first()).then(({data:a})=>{const t=a.value;M.value=Array.isArray(t?.entries)?t.entries:[]}),Je("total-svampar-skogsbruk",()=>Qe("totalSvamparSkogsbruk").first()).then(({data:a})=>{const t=a.value;C.value=Array.isArray(t?.entries)?t.entries:[]});const w=R([]);J(async()=>{try{let a=await fetch("/småplantor.json");a.ok||(a=await fetch("/småplantor.json"));const t=await a.json();w.value=Array.isArray(t?.trees)?t.trees:Array.isArray(t)?t:[]}catch(a){console.error("Failed fetching småplantor points:",a)}});const h=R([]);J(async()=>{try{const t=await(await fetch("/hogstubbar.json")).json();h.value=Array.isArray(t?.stubbar)?t.stubbar:Array.isArray(t)?t:[]}catch(a){console.error("Failed fetching högstubbar points:",a)}}),J(async()=>{try{const t=await(await fetch("/api/kanteffekt")).json();I.value=t.features||[]}catch(a){console.error("Failed fetching kanteffekt features:",a)}});const I=R([]),j=R([]);J(async()=>{try{const t=await(await fetch("/api/savedclicks")).json();j.value=t.clicks||[]}catch(a){console.error("Failed fetching saved clicks:",a)}});const ie=Xt(),V=pr(),n=R(null),N=R(!1),p=R(null),L=R({visible:!1,top:0,left:0,width:0,height:0}),$=q(()=>({position:"absolute",top:L.value.top+"px",left:L.value.left+"px",width:L.value.width+"px",height:L.value.height+"px"})),B=(a,t)=>a==="alla"?!0:Array.isArray(a)?a.includes("alla")||a.includes(t):a===t,ve=(a,t)=>a==="alla"?!0:Array.isArray(a)?a.includes("alla")||a.includes(t):a===t,T=document.createElement("canvas");let e=null,W=null;function oe(){T.style.position="absolute",T.style.top="0",T.style.left="0",T.style.width="100%",T.style.height="100%",T.style.pointerEvents="none",T.style.zIndex="20",p.value.appendChild(T),T.width=p.value.clientWidth,T.height=p.value.clientHeight,e=T.getContext("2d"),W&&W.disconnect(),W=new ResizeObserver(me),W.observe(p.value);try{n.value?.addHandler?.("animation",()=>P()),n.value?.addHandler?.("animation-finish",()=>P()),n.value?.addHandler?.("viewport-change",()=>P())}catch{}}function me(){T.width=p.value.clientWidth,T.height=p.value.clientHeight,P()}const le=document.createElement("canvas");le.width=le.height=8;const H=le.getContext("2d");H.fillStyle="rgba(255,255,255,0.3)",H.fillRect(0,0,8,8),H.strokeStyle="rgba(115,115,115,0.3)",H.lineWidth=4,H.beginPath(),H.moveTo(0,8),H.lineTo(8,0),H.stroke();function P(){if(!n.value||!e)return;if(e.createPattern(le,"repeat"),e.clearRect(0,0,T.width,T.height),L.value.visible=!1,r.retentionVisible){const o=Array.isArray(x.value)?x.value:Array.isArray(x.value?.trees)?x.value.trees:[];Array.isArray(x.value)||console.warn("[OSD] localTrees.value was not an array; using fallback array."),o.forEach(l=>{if(!l||l.framework!==r.currentFramework.value||!B(l.time,r.currentTime)||l.startskog!==r.currentStartskog.value)return;const s=new v.Point(l.x,l.y),i=n.value.viewport.pixelFromPoint(s,!0),m=.03/2,g=n.value.viewport.pixelFromPoint(new v.Point(l.x+m,l.y),!0),y=Math.abs(g.x-i.x),b=e.createRadialGradient(i.x,i.y,0,i.x,i.y,y);b.addColorStop(0,"rgba(255,255,255,0.55)"),b.addColorStop(1,"rgba(255,255,255,0.85)"),e.save(),e.beginPath(),e.arc(i.x,i.y,y,0,2*Math.PI),e.closePath(),e.fillStyle=b,e.fill(),e.restore(),e.beginPath(),e.arc(i.x,i.y,y,0,2*Math.PI),e.strokeStyle="rgba(255,255,255,0)",e.lineWidth=2,e.stroke()})}if(r.tradplantorVisible&&r.currentFramework.value==="trakthygge"&&r.currentTime==="20 år"){const i=n.value.viewport.pixelFromPoint(new v.Point(.2671,.1383),!0),m=n.value.viewport.pixelFromPoint(new v.Point(.7312,.4152),!0),g=Math.min(i.x,m.x),y=Math.max(i.x,m.x),b=Math.min(i.y,m.y),A=Math.max(i.y,m.y);e.save(),e.beginPath(),e.rect(g,b,y-g,A-b),e.clip();const d=Math.abs(.7312-.2671),k=Math.abs(.4152-.1383),E=100,G=Math.max(1,Math.round(E*(k/d))),K=d/E,X=k/G,ue=3;e.beginPath();for(let U=0;U<G;U++){const te=.1383+(U+.5)*X;for(let de=0;de<E;de++){const Y=.2671+(de+.5)*K,O=n.value.viewport.pixelFromPoint(new v.Point(Y,te),!0);e.moveTo(O.x+ue,O.y),e.arc(O.x,O.y,ue,0,Math.PI*2)}}e.fillStyle="rgba(255,255,255,0.85)",e.fill(),e.restore()}if(r.naturvardsarterVisible&&f.value&&f.value.length){const t=Array.isArray(f.value)?f.value:[],o=(l,s,i,m)=>{const y=Math.PI/5,b=m*.5;l.beginPath();let A=-Math.PI/2;for(let d=0;d<5;d++)l.lineTo(s+Math.cos(A)*m,i+Math.sin(A)*m),A+=y,l.lineTo(s+Math.cos(A)*b,i+Math.sin(A)*b),A+=y;l.closePath()};t.forEach(l=>{if(!l||l.framework&&!ve(l.framework,r.currentFramework.value)||l.startskog&&l.startskog!==r.currentStartskog.value||l.time&&!B(l.time,r.currentTime))return;const s=new v.Point(l.x,l.y),i=n.value.viewport.pixelFromPoint(s,!0),m=.012,g=n.value.viewport.pixelFromPoint(new v.Point(l.x+m,l.y),!0),y=Math.abs(g.x-i.x);e.save(),o(e,i.x,i.y,y),e.fillStyle="rgba(153,246,228, 1)",e.fill(),e.lineWidth=2,e.strokeStyle="rgb(20,184,166)",e.stroke(),e.restore()})}if(r.smaplantorVisible&&w.value&&w.value.length&&(Array.isArray(w.value)?w.value:[]).forEach(o=>{if(!o||o.framework&&o.framework!==r.currentFramework.value||o.startskog&&o.startskog!==r.currentStartskog.value||o.time&&!B(o.time,r.currentTime))return;const l=new v.Point(o.x,o.y),s=n.value.viewport.pixelFromPoint(l,!0),i=5e-4,m=n.value.viewport.pixelFromPoint(new v.Point(o.x+i,o.y),!0),g=Math.abs(m.x-s.x);e.save(),e.beginPath(),e.arc(s.x,s.y,g,0,2*Math.PI),e.fillStyle="rgba(255, 255, 255, 0.95)",e.fill(),e.lineWidth=1,e.strokeStyle="rgba(255,255,255,1)",e.stroke(),e.restore()}),r.hogstubbarVisible&&h.value&&h.value.length&&(Array.isArray(h.value)?h.value:[]).forEach(o=>{if(!o||o.framework&&o.framework!==r.currentFramework.value||o.startskog&&o.startskog!==r.currentStartskog.value||o.time&&!B(o.time,r.currentTime))return;const l=new v.Point(o.x,o.y),s=n.value.viewport.pixelFromPoint(l,!0),i=.003,m=n.value.viewport.pixelFromPoint(new v.Point(o.x+i,o.y),!0),g=Math.abs(m.x-s.x);e.save(),e.beginPath(),e.arc(s.x,s.y,g,0,2*Math.PI),e.fillStyle="rgba(0, 0, 0, 0.55)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.6)",e.stroke(),e.restore()}),r.seedTreeVisible){const o=Array.isArray(S.value)?S.value:Array.isArray(S.value?.trees)?S.value.trees:[];Array.isArray(S.value)||console.warn("[OSD] localSeedTrees.value was not an array; using fallback array."),o.forEach(l=>{if(l.framework!==r.currentFramework.value||!B(l.time,r.currentTime)||l.startskog!==r.currentStartskog.value)return;const s=new v.Point(l.x,l.y),i=n.value.viewport.pixelFromPoint(s,!0),m=.03/2,g=n.value.viewport.pixelFromPoint(new v.Point(l.x+m,l.y),!0),y=Math.abs(g.x-i.x),b=e.createRadialGradient(i.x,i.y,0,i.x,i.y,y);b.addColorStop(0,"rgba(255,255,255,0.55)"),b.addColorStop(1,"rgba(255,255,255,0.85)"),e.save(),e.beginPath(),e.arc(i.x,i.y,y,0,Math.PI*2),e.closePath(),e.fillStyle=b,e.fill(),e.restore(),e.beginPath(),e.arc(i.x,i.y,y,0,Math.PI*2),e.strokeStyle="rgba(255,255,255,0)",e.lineWidth=2,e.stroke()})}const a=I.value.filter(t=>t.framework===r.currentFramework.value&&(Array.isArray(t.start)?t.start.includes(r.currentTime):t.start===r.currentTime));if(r.kanteffektVisible&&a.filter(t=>t.shape==="polygon").forEach(t=>{let o=1;if(t.framework==="trakthygge"&&(o={efter:1,"20 år":.5,"50 år":.5,"80 år":.5}[r.currentTime]??.5),!r.oldKanteffektVisible&&o===.5)return;const l=o,s=[[.7312,.1383],[.7312,.4152],[.2672,.4152],[.2671,.1383]].map(([d,k])=>n.value.viewport.pixelFromPoint(new v.Point(d,k),!0)),i=[[.719,.1448],[.5799,.1448],[.5799,.1528],[.28,.1528],[.28,.403],[.719,.403]].map(([d,k])=>n.value.viewport.pixelFromPoint(new v.Point(d,k),!0));e.save(),e.beginPath(),s.forEach((d,k)=>k===0?e.moveTo(d.x,d.y):e.lineTo(d.x,d.y)),e.closePath(),e.moveTo(i[0].x,i[0].y),i.forEach((d,k)=>e.lineTo(d.x,d.y)),e.closePath(),e.clip("evenodd"),e.globalAlpha=l,e.translate(0,0),e.rotate(-45*Math.PI/180);const m=4,g=T.width,y=T.height,b=Math.hypot(g,y),A=Math.ceil((b+m*2)/(m*2));for(let d=-A;d<=A;d++){const k=d*m*2;e.fillStyle="rgba(255,255,255,1)",e.fillRect(k,-b,m,b*2),e.fillStyle="rgba(115,115,115,0.5)",e.fillRect(k+m,-b,m,b*2)}e.restore(),e.save(),e.globalAlpha=l,e.beginPath(),s.forEach((d,k)=>k===0?e.moveTo(d.x,d.y):e.lineTo(d.x,d.y)),e.closePath(),e.moveTo(i[0].x,i[0].y),i.forEach((d,k)=>e.lineTo(d.x,d.y)),e.closePath(),e.strokeStyle="rgba(255,255,255,0.8)",e.lineWidth=1,e.stroke(),e.restore()}),r.kanteffektVisible&&a.filter(t=>t.shape==="squareHole").forEach(t=>{const o=t.size/2,l=t.holeSize/2,s=new v.Point(t.x,t.y),i=n.value.viewport.pixelFromPoint(s,!0),m=n.value.viewport.pixelFromPoint(new v.Point(t.x+o,t.y),!0),g=Math.abs(m.x-i.x),y=g*2,b=n.value.viewport.pixelFromPoint(new v.Point(t.x+l,t.y),!0),A=Math.abs(b.x-i.x);let d=null;const k=typeof t.id=="string"?t.id.match(/ke-luckh-(\d+)/):null;k&&(d=parseInt(k[1],10));const E=[2,4,8,11,14],G=[1,3,7,10,13],K=[5,6,9,12,15],X=r.currentTime;let ue=.5;if(d!=null){let O=.5;if(E.includes(d)?O={efter:1,"20 år":1,"50 år":.5,"80 år":.5}[X]??.5:G.includes(d)?O={"50 år":1,"80 år":.5}[X]??.5:K.includes(d)&&(O={"80 år":1}[X]??.5),!r.oldKanteffektVisible&&O===.5)return;ue=O}e.save(),e.globalAlpha=ue,e.beginPath(),e.rect(i.x-g,i.y-g,y,y),e.rect(i.x-A,i.y-A,A*2,A*2),e.clip("evenodd"),e.translate(i.x,i.y),e.rotate(-45*Math.PI/180);const U=4,te=Math.hypot(y,y),de=Math.ceil((te+U*2)/(U*2));for(let O=-de;O<=de;O++){const re=O*U*2;e.fillStyle="rgba(255,255,255,1)",e.fillRect(re,-te,U,te*2),e.fillStyle="rgba(115,115,115,0.8)",e.fillRect(re+U,-te,U,te*2)}e.restore(),e.save(),e.globalAlpha=ue,e.beginPath(),e.rect(i.x-g,i.y-g,y,y),e.strokeStyle="rgba(255,255,255,1)",e.lineWidth=1,e.stroke(),e.restore();let Y=null;if(d!=null&&(E.includes(d)||G.includes(d)||K.includes(d))&&(Y=""),Y){const O=Math.max(9,Math.min(14,y*.12)),re=i.x-g,Lt=i.y-g,Pe=Math.max(3,O*.3),Se=Math.max(2,O*.2);e.save(),e.globalAlpha=1,e.font=`${O}px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif`,e.textAlign="left",e.textBaseline="top";const Bt=e.measureText(Y).width,Wt=O*1.2,Xe=re+Pe,Ye=Lt+Se,Ht=Bt+Pe*2,Dt=Wt+Se*2;e.fillStyle="rgba(0,0,0,0.85)",e.fillRect(Xe-Pe,Ye-Se,Ht,Dt),e.fillStyle="white",e.fillText(Y,Xe,Ye),e.restore()}e.globalAlpha=1}),r.rottackeVisible){const t=r.currentFramework.value,o=r.currentTime,l=t==="skärmträd"||t==="skarmtrad",s=t==="blädning"||t==="bladning";if(l&&o==="efter"||s&&(o==="efter"||o==="20 år"||o==="50 år"||o==="80 år")){const g={x:.2675,y:.1393,width:.465,height:.275},y=n.value.viewport.pixelFromPoint(new v.Point(g.x,g.y),!0),b=n.value.viewport.pixelFromPoint(new v.Point(g.x+g.width,g.y+g.height),!0),A=b.x-y.x,d=b.y-y.y;s&&o==="efter"&&(L.value={visible:!0,top:Math.min(y.y,b.y),left:Math.min(y.x,b.x),width:Math.abs(A),height:Math.abs(d)}),e.save(),e.beginPath(),e.rect(y.x,y.y,A,d),e.clip(),e.translate(y.x+A/2,y.y+d/2),e.rotate(-45*Math.PI/180);const k=4,E=Math.hypot(A,d),G=Math.ceil((E+k*2)/(k*2));for(let K=-G;K<=G;K++){const X=K*k*2;e.fillStyle="rgba(255,255,255,0.7)",e.fillRect(X,-E,k,E*2),e.fillStyle="rgba(115,115,115,0.5)",e.fillRect(X+k,-E,k,E*2)}e.restore(),e.save(),e.strokeStyle="rgba(255,255,255,0.8)",e.lineWidth=2,e.strokeRect(y.x,y.y,A,d),e.restore()}}if(_.staticOverlayVisible){const t={x:.2675,y:.1393,width:.465,height:.275},o=n.value.viewport.pixelFromPoint(new v.Point(t.x,t.y),!0),l=n.value.viewport.pixelFromPoint(new v.Point(t.x+t.width,t.y+t.height),!0),s=l.x-o.x,i=l.y-o.y;e.strokeStyle="white",e.lineWidth=2,e.strokeRect(o.x,o.y,s,i)}j.value.length&&j.value.forEach(t=>{if(t.framework&&t.framework!==r.currentFramework.value||t.startskog&&t.startskog!==r.currentStartskog.value||t.time&&!B(t.time,r.currentTime))return;const o=new v.Point(t.x,t.y),l=n.value.viewport.pixelFromPoint(o,!0),s=5e-4,i=n.value.viewport.pixelFromPoint(new v.Point(t.x+s,t.y),!0),m=Math.abs(i.x-l.x);e.save(),e.beginPath(),e.arc(l.x,l.y,m,0,2*Math.PI),e.fillStyle="rgba(255, 255, 255, 0.95)",e.fill(),e.lineWidth=1,e.strokeStyle="rgba(255, 255, 255, 1)",e.stroke(),e.restore()})}const _=$t();z(()=>r.retentionVisible,()=>{e&&P()}),z(()=>r.kanteffektVisible,()=>{e&&P()}),z(()=>_.staticOverlayVisible,()=>{e&&P()}),z(()=>r.oldKanteffektVisible,()=>{e&&P()}),z(()=>r.currentTime,()=>{e&&P()}),z(()=>r.currentFramework,()=>{e&&P()}),z(()=>r.rottackeVisible,()=>{e&&P()}),z(()=>r.seedTreeVisible,()=>{e&&P()}),z(()=>r.devSaveClicks,()=>{e&&P()}),z(()=>r.smaplantorVisible,()=>{e&&P()}),z(()=>r.hogstubbarVisible,()=>{e&&P()}),z(()=>r.naturvardsarterVisible,()=>{e&&P()}),z(()=>r.tradplantorVisible,()=>{e&&P()}),J(async()=>{try{const t=await(await fetch("/api/seedTrees")).json();S.value=t.trees||[]}catch(a){console.error("Failed fetching seedTrees:",a)}});const D=q(()=>"openseadragon-viewer-"+Math.random().toString(36).substr(2,9));let v=null;const ee=R(null),se=R(null);function Be(a){n.value&&(se.value&&(n.value.world.removeItem(se.value),se.value.destroy(),se.value=null),a&&n.value.addTiledImage({tileSource:a,crossOriginPolicy:"Anonymous",ajaxWithCredentials:!1,opacity:we.value,success:t=>{se.value=t.item}}))}let ce=[],ye=[],he;function We(){if(!n.value)return;he&&(n.value.removeHandler("animation",he),he=null),ye.forEach(t=>t.destroy()),ye=[],ce.forEach(({id:t,app:o})=>{o.unmount(),n.value.removeOverlay(t)}),ce=[],p.value.querySelectorAll(".osd-snapshot").forEach(t=>t.remove());const a=p.value.querySelector("canvas");if(a){const t=a.getContext("webgl")||a.getContext("experimental-webgl");if(t){const o=t.getExtension("WEBGL_lose_context");o&&o.loseContext()}}W&&(W.disconnect(),W=null),window.removeEventListener("resize",me),T.parentNode&&T.parentNode.removeChild(T),n.value.clearOverlays(),n.value.destroy(),n.value=null,ee.value=null,se.value=null}const kt=vr(a=>Ke(a),100);z(()=>r.dziUrl,(a,t)=>{n.value&&a!==t&&kt(a)}),z(()=>r.overlayDziUrl,(a,t)=>{!n.value||a===t||Be(a)});const He=xr(),Pt=q(()=>He.isPanelMinimized);function St(){He.togglePanel()}const be=q(()=>{let a;const t=r.currentTime.toLowerCase();return t.includes("innan")?a=0:t.includes("efter")?a=1:a=parseInt(r.currentTime),console.log("currentTime:",r.currentTime,"numericTime:",a),a}),De=q(()=>be.value===0?-2:be.value),Tt=q(()=>be.value===0?-4:be.value),_t=q(()=>{const a=C.value.find(t=>t.artkategori==="total"&&t.frameworks===r.currentFramework.value&&Number(t.ålder)===Tt.value);return a?a.klassning:"N/A"}),At=q(()=>{const a=M.value.find(t=>t.artkategori==="matsvamp"&&t.startskog===r.currentStartskog.value&&t.frameworks===r.currentFramework.value&&Number(t.ålder)===De.value);return a?a.klassning:"N/A"}),Mt=q(()=>{const a=M.value.find(t=>t.artkategori==="rödlistade + signalarter"&&t.startskog===r.currentStartskog.value&&t.frameworks===r.currentFramework.value&&Number(t.ålder)===De.value);return a?a.klassning:"N/A"}),Ct=q(()=>!r.currentFramework?.value||!r.currentTime||!r.currentStartskog?.value?null:er.find(a=>a.atgard===r.currentFramework.value&&a.tid===r.currentTime&&a.startskog===r.currentStartskog.value)),ke=R({x:0,y:0});function Ot(a){if(!p.value||!n.value||!v)return;const t=p.value.getBoundingClientRect(),o=a.clientX-t.left,l=a.clientY-t.top,s=new v.Point(o,l),i=n.value.viewport.pointFromPixel(s);ke.value.x=i.x,ke.value.y=i.y}function zt(a){if(!r.devSaveClicks||!p.value||!n.value||!v)return;const t=p.value.getBoundingClientRect(),o=a.clientX-t.left,l=a.clientY-t.top,s=new v.Point(o,l),i=n.value.viewport.pointFromPixel(s),g=a.metaKey||a.ctrlKey?"alla":r.currentTime,y={framework:r.currentFramework.value,time:g,startskog:r.currentStartskog.value,x:i.x,y:i.y,id:`click-${Date.now()}`};fetch("/api/savedclicks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).catch(b=>console.error("Failed saving click:",b)),j.value.push(y)}const Ue=bt();z(()=>Ue.selectedAnnotation,()=>{n.value&&Ze()});function Ze(){!n.value||!v||(ye.forEach(a=>a.destroy()),ye=[],ce.forEach(({id:a,app:t})=>{t.unmount(),n.value.removeOverlay(a)}),ce=[],r.annotations.forEach(a=>{if(!a.position)return;const t=document.createElement("div"),o=Ue.selectedAnnotation;o&&o.id===a.id?t.style.zIndex="6":t.style.zIndex="5";const l=et(wr,{annotation:a});l.mount(t);const s=new v.MouseTracker({element:t,clickHandler:()=>{c("annotationClicked",a)}});ye.push(s);const i="annotation-"+a.id;t.id=i,n.value.addOverlay({element:t,location:new v.Point(a.position.x,a.position.y),placement:"BOTTOM",checkResize:!1}),ce.push({id:i,app:l})}))}function Rt(a){if(!n.value||!v)return;const t=`popup-${a.id}`,o=document.createElement("div");o.id=t,o.style.pointerEvents="auto",n.value.addOverlay({element:o,location:new v.Point(a.position.x,a.position.y)});const l=et(hr,{annotation:a});l.mount(o),ce.push({id:t,app:l})}async function Ge(){if(typeof window>"u"||n.value||ie.name!=="skogsskotsel")return;const a=p.value;if(!a)return;const t=await $e(()=>import("./B9rKIRhJ.js").then(s=>s.o),__vite__mapDeps([0,1]),import.meta.url),o=t.default||t;v=o,window.OpenSeadragon=v,await $e(()=>import("./HoRGMImp.js"),[],import.meta.url);const l={element:a,crossOriginPolicy:"Anonymous",ajaxWithCredentials:!1,showNavigationControl:!1,maxImageCacheCount:50,visibilityRatio:1,homeFillsViewer:!0,minZoomLevel:1,wrapHorizontal:!1,wrapVertical:!0,constrainDuringPan:!0,panHorizontal:!0,panVertical:!0,homeFillsViewer:!0,animationTime:.5,defaultZoomLevel:r.layoutMode==="sideBySide"?null:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!1,dblClickToZoom:!0,clickTodrag:!1,pinchToZoom:!1},drawer:"canvas"};if(n.value=o(l),oe(),P(),n.value.addHandler("animation",P),n.value.addHandler("open",P),n.value.scalebar({type:v.ScalebarType.MAP,pixelsPerMeter:10,minWidth:"75px",location:v.ScalebarLocation.BOTTOM_LEFT,color:"white",fontColor:"white",backgroundColor:"rgba(0, 0, 0, 0.2)",barThickness:2}),V.center){const{x:s,y:i}=V.center;n.value.viewport.zoomTo(V.zoom),n.value.viewport.panTo(new v.Point(s,i)),n.value.viewport.applyConstraints()}he=()=>{const s=n.value.viewport.getZoom(),i=n.value.viewport.getCenter();V.setViewport(s,{x:i.x,y:i.y}),c("viewportChanged",{zoom:s,center:i})},n.value.addHandler("animation",he),Ke(r.dziUrl)}function Ke(a){if(!n.value||!a)return;p.value.querySelectorAll(".osd-snapshot").forEach(m=>p.value.removeChild(m));const o=n.value.viewport.getZoom(),l=n.value.viewport.getCenter();let s=null;try{s=n.value.drawer.canvas.toDataURL("image/png")}catch(m){console.warn("Snapshot capture failed:",m)}let i=null;s&&(i=document.createElement("img"),i.classList.add("osd-snapshot"),i.src=s,i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.zIndex="0",i.style.opacity="1",i.style.transition="opacity 0.5s ease",p.value.appendChild(i)),n.value.open({tileSource:a,crossOriginPolicy:"Anonymous",ajaxWithCredentials:!1}),n.value.addOnceHandler("open",()=>{n.value.viewport.zoomTo(o,null,!0),n.value.viewport.panTo(l,!0),n.value.viewport.applyConstraints(),c("opened"),Be(r.overlayDziUrl),i&&setTimeout(()=>{i.style.opacity="0",setTimeout(()=>{p.value.contains(i)&&p.value.removeChild(i)},500)},50)})}const we=R(r.globalOpacity!==void 0?r.globalOpacity:1);z(()=>r.globalOpacity,a=>{if(a!==void 0&&(we.value=a,n.value&&r.overlayDziUrl)){const t=n.value.world.getItemCount();for(let o=0;o<t;o++){const l=n.value.world.getItemAt(o);let s="";l.source.tilesUrl?s=l.source.tilesUrl.slice(0,-7)+".dzi":l.source.url&&(s=l.source.url),s===r.overlayDziUrl&&(typeof l.setOpacity=="function"&&l.setOpacity(a),l.tiles&&l.tiles.length&&l.tiles.forEach(i=>{i.elmt&&(i.elmt.style.opacity=a)}))}n.value.forceRedraw()}},{immediate:!0});function It(a){const t=parseFloat(a.target.value);if(we.value=t,n.value&&r.overlayDziUrl){const o=n.value.world.getItemCount();for(let l=0;l<o;l++){const s=n.value.world.getItemAt(l);let i="";s.source.tilesUrl?i=s.source.tilesUrl.slice(0,-7)+".dzi":s.source.url&&(i=s.source.url),i===r.overlayDziUrl&&(typeof s.setOpacity=="function"&&s.setOpacity(t),s.tiles&&s.tiles.length&&s.tiles.forEach(m=>{m.elmt&&(m.elmt.style.opacity=t)}))}n.value.forceRedraw(),ee.value&&typeof ee.value.setOpacity=="function"&&ee.value.setOpacity(t>=1?0:1),n.value.forceRedraw()}r.globalOpacity!==void 0&&c("update:globalOpacity",t)}z(()=>r.annotations,()=>{Ze()},{immediate:!0}),Yt(()=>{We()}),J(()=>{typeof window>"u"||(N.value=!0,Jt(()=>{Ge().then(()=>{})}))});function jt(a=1.2){if(!n.value)return;const o=n.value.viewport.getZoom()*a;return n.value.viewport.zoomTo(o),n.value.viewport.applyConstraints(),n.value.forceRedraw(),o}function Ft(a=1.2){if(!n.value)return;const o=n.value.viewport.getZoom()/a;return n.value.viewport.zoomTo(o),n.value.viewport.applyConstraints(),n.value.forceRedraw(),o}function Et(){return n.value?n.value.viewport.getZoom():null}function Vt(){return n.value?n.value.viewport.getCenter():null}function qt(a,t){n.value&&(n.value.viewport.zoomTo(a),n.value.viewport.panTo(t),n.value.viewport.applyConstraints(),n.value.forceRedraw())}function Nt(a,t){n.value&&n.value.addHandler(a,t)}return u({showPopup:Rt,zoomIn:jt,zoomOut:Ft,getZoom:Et,getCenter:Vt,setZoomAndCenter:qt,addSyncHandler:Nt}),document.addEventListener("visibilitychange",()=>{document.hidden?We():Ge()}),{isClient:N,viewerContainer:p,viewerId:D,mousePos:ke,updateMousePosition:Ot,handleRetentionClick:zt,handleSliderInput:It,overlayOpacityLocal:we,timelineInfo:Ct,isPanelMinimized:Pt,togglePanelMinimized:St,svampMycelValue:_t,matsvampMycelValue:At,rodlistadeMycelValue:Mt,rottackePopover:L,rottackePopoverStyle:$,localSeedTrees:S}}},Pr=["id"],Sr={key:0,class:"absolute top-0 left-1/2 transform -translate-x-1/2 m-2 z-10 text-center"},Tr={class:"col-span-2"},_r={class:"w-full"},Ar={class:"w-full text-md relative group pointer-events-auto"},Mr={key:0},Cr={class:"text-3xl mt-2 font-medium"},Or={class:"text-md text-neutral-500 mb-4"},zr={key:0,class:"mb-6"},Rr={key:1,class:""};function Ir(r,c,u,f,x,S){const M=ht,C=Kt;return Z(),Q("div",{class:ne(["relative",u.fullscreenLayout?" gap-4":"grid md:grid-cols-5 gap-8"])},[f.isClient?(Z(),Q("div",{key:0,id:f.viewerId,class:ne(["openseadragon-viewer ui-zoom-exempt col-span-3 relative overflow-hidden",u.fullscreenLayout?"":"rounded-sm"]),ref:"viewerContainer",style:Te({backgroundColor:u.backgroundColor}),onMousedownCapture:c[0]||(c[0]=(...w)=>r.handleActivate&&r.handleActivate(...w)),onMousemove:c[1]||(c[1]=(...w)=>f.updateMousePosition&&f.updateMousePosition(...w)),onClick:c[2]||(c[2]=w=>f.handleRetentionClick(w))},[!(u.layoutMode==="slider"&&u.comparisonMode)&&u.fullscreenLayout?(Z(),Q("div",Sr,[F("div",null,[ge(M,{size:"lg",class:"backdrop-blur-xl bg-neutral-400/10 text-neutral-100 mb-0.5 z-50"},{default:xe(()=>[_e(fe(u.frameworkLabel),1)]),_:1})]),ge(M,{size:"lg",class:"backdrop-blur-xl bg-neutral-400/10 text-neutral-100 z-50"},{default:xe(()=>[_e(fe(u.timeLabel),1)]),_:1})])):ae("",!0),ge(C,{class:"hover:cursor-pointer","open-delay":500,"close-delay":300},{content:xe(()=>[...c[3]||(c[3]=[F("div",{class:"p-3 max-w-xs"}," I princip är hela området täckt av rötter där svampar kan överleva ",-1)])]),default:xe(()=>[F("div",{style:Te(f.rottackePopover.visible?f.rottackePopoverStyle:{position:"absolute",top:"-99999px",left:"-99999px",width:"1px",height:"1px",pointerEvents:"none"}),class:"absolute z-[10000]",tabindex:"0",role:"button","aria-label":"Kontinuerligt rottäcke"},null,4)]),_:1})],46,Pr)):ae("",!0),F("div",Tr,[F("div",{class:ne(["pointer-events-none bottom-0  z-10",(u.layoutMode==="slider"&&u.comparisonMode,"w-full")]),style:Te({zIndex:10,...u.sliderPosition==="left"?{left:"0px",paddingRight:(u.layoutMode==="slider"&&u.comparisonMode,"0px")}:{right:"0px",paddingLeft:(u.layoutMode==="slider"&&u.comparisonMode,"0px")}})},[F("div",_r,[u.fullscreenLayout?ae("",!0):(Z(),Q("div",{key:0,class:ne(["flex w-full",u.sliderPosition==="left"?"":"justify-end"])},[F("div",Ar,[f.isPanelMinimized?ae("",!0):(Z(),Q("div",Mr,[F("h1",Cr,fe(u.frameworkLabel),1),F("h1",Or,fe(u.timeLabel),1),f.timelineInfo?(Z(),Q("p",zr,fe(f.timelineInfo.skog),1)):ae("",!0),f.timelineInfo?(Z(),Q("p",Rr,[c[4]||(c[4]=F("div",{class:"font-bold mb-1.5 text-lg"},"Påverkan på mykorrizasvamp",-1)),_e(" "+fe(f.timelineInfo.svamp),1)])):ae("",!0),c[5]||(c[5]=F("div",{class:"overflow-hidden mt-1 px-2 w-full flex"},null,-1))]))])],2))])],6)])],2)}const Qr=Object.assign(yt(kr,[["render",Ir],["__scopeId","data-v-1e0697f9"]]),{__name:"OpenSeadragonViewer"});export{Qr as default};
