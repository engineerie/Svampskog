import{b5 as Q,ai as j,bc as q,r as z,a5 as G,o as H,d as I,f as W,e as N,h as A,a9 as B,av as P,g as $,w as X,aO as U,t as V,b2 as Y}from"./CnLc4XRp.js";const R={retention:{slug:"retention-trees",fields:{framework:"framework",startskog:"startskog",time:"time"}},seedTree:{slug:"seed-trees",fields:{framework:"framework",startskog:"startskog",time:"time"}},smaplantor:{slug:"smaplantor",fields:{framework:"framework",startskog:"startskog",time:"time"}},hogstubbar:{slug:"hogstubbar",fields:{framework:"framework",startskog:"startskog",time:"time"}},naturvardsarter:{slug:"naturvard",fields:{framework:"framework",startskog:"startskog",time:"time"}},kanteffekt:{slug:"kanteffekt",fields:{framework:"framework",startskog:null,time:"start"}}},D=Object.keys(R);function M(e){return e?e.replace(/_+$/g,""):e??null}function C(e,r,t=!0){if(!r)return!1;if(e==null)return!0;const n=M(r);return Array.isArray(e)?t&&e.includes("alla")||e.some(m=>M(String(m))===n):typeof e=="string"?t&&e==="alla"?!0:M(e)===n:!1}function K(e,r,t,n={}){const{ignoreStartskog:m=!1}=n,{fields:l}=t;return e.filter(u=>{if(!u)return!1;if(l.framework){const a=u[l.framework];if(!C(a,r.framework,!1))return!1}if(l.startskog&&!m&&r.startskog){const a=u[l.startskog];if(!C(a,r.startskog,!0))return!1}if(l.time){const a=u[l.time];if(!C(a,r.time,!0))return!1}return!0})}function Z(e,r,t){if(!Array.isArray(e)||e.length===0)return[];if(!r?.framework||!r?.time)return e;const n={framework:M(r.framework),startskog:M(r.startskog),time:r.time};if(t.slug==="retention-trees"){const u=n.framework,a=n.time;return!u||u==="naturskydd"?[]:!a||a==="innan"?[]:(Array.isArray(e)?e:[]).map(f=>({...f,framework:"alla",startskog:"alla",time:"alla"}))}let l=K(e,n,t);return l.length===0&&t.fields.startskog&&n.startskog&&(l=K(e,n,t,{ignoreStartskog:!0})),l}const ee=["innan","efter","10 år","20 år","50 år","80 år"],te={retention:!0,kanteffekt:!0,rottacke:!0,seedTree:!0,smaplantor:!0,hogstubbar:!0,naturvardsarter:!0,tradplantor:!0};function re(e){const r=e.framework,t=e.time;if(!r||!t)return!0;const n=r==="skärmträd"||r==="skarmtrad",m=r==="blädning"||r==="bladning",l=n&&t==="efter",u=m&&["efter","20 år","50 år","80 år"].includes(t);return l||u}function ae(e){const r=e.framework,t=e.time;return!r||!t?!0:r==="trakthygge"&&t==="efter"}async function L(e){try{const r=await fetch(encodeURI(e));return r.ok?await r.json():null}catch{return null}}function se(e){switch(e){case"blädning":return["blädning","bladning"];case"skärmträd":return["skärmträd","skarmtrad"];default:return[e]}}function ne(e){if(!e||typeof e!="object")return[];const r=Array.isArray(e.points)?e.points:[],t=new Map;r.length&&r.forEach(i=>{i?.id!=null&&t.set(i.id,i)});const n=e.startskogSets??null,m=e.markers??{},l=e.defaults??{},u=e.frameworks??{},a=Array.isArray(e.timelineOrder)?[...e.timelineOrder]:[...ee],o=new Set(a);Object.values(u).forEach(i=>{!i||typeof i!="object"||Object.values(i).forEach(y=>{Array.isArray(y)&&y.forEach(g=>{const s=g?.time;s&&!o.has(s)&&(o.add(s),a.push(s))})})});const f=a,p=new Map;r.length&&n&&typeof n=="object"?Object.entries(n).forEach(([i,y])=>{const g=new Map;Array.isArray(y)&&y.forEach(s=>{const d=t.get(s);d&&g.set(s,d)}),p.set(i,g)}):Object.entries(m).forEach(([i,y])=>{const g=new Map;Array.isArray(y)&&y.forEach(s=>{s?.id!=null&&g.set(s.id,s)}),p.set(i,g)});const k=[];return Object.entries(u).forEach(([i,y])=>{const g=se(i),s=y??{};p.forEach((d,h)=>{if(!d||d.size===0)return;const S=Array.from(d.keys()),x=Array.isArray(l[h])?l[h]:S;let O=new Set(x),_=new Set;const J=Array.isArray(s[h])?s[h]:[],F=new Map;J.forEach(E=>{E?.time&&F.set(E.time,E)}),f.forEach(E=>{let b=new Set(O);const v=F.get(E);v&&(v.set&&(v.set==="base"?b=new Set(x):v.set==="all"?b=new Set(S):Array.isArray(v.set)&&(b=new Set(v.set))),Array.isArray(v.remove)&&v.remove.forEach(c=>{b.delete(c),_.add(c)}),Array.isArray(v.add)&&v.add.forEach(c=>{b.add(c),_.delete(c)})),O.forEach(c=>{b.has(c)||_.add(c)}),b.forEach(c=>{_.has(c)&&_.delete(c)}),g.forEach(c=>{b.forEach(T=>{const w=d.get(T)||t.get(T);w&&k.push({id:w.id,x:w.x,y:w.y,framework:c,startskog:h,time:E,removed:!1})}),_.forEach(T=>{const w=d.get(T)||t.get(T);w&&k.push({id:w.id,x:w.x,y:w.y,framework:c,startskog:h,time:E,removed:!0})})}),O=new Set(b)})})}),k}function oe(e){return e?Array.isArray(e.mycelium)?e.mycelium:e.markers&&e.frameworks||e.points&&e.startskogSets&&e.frameworks?ne(e):[]:[]}async function ie(){const e=["/småplantor.json","/småplantor.json"];for(const r of e){const t=await L(r);if(t)return t}return null}async function le(){const e=["/seedTrees.json","/overlays/seedTrees.json","/api/seedTrees"];for(const r of e){const t=await L(r);if(t)return t}return null}async function ue(){const e=["/kanteffekt.json","/overlays/kanteffekt.json","/api/kanteffekt"];for(const r of e){const t=await L(r);if(t)return t}return null}function ve(){const{data:e,pending:r}=Q("overlay-datasets-json",async()=>{const[a,o,f,p,k,i]=await Promise.all([L("/retentionTrees.json"),le(),ie(),L("/hogstubbar.json"),L("/naturvard.json"),ue()]);return{"retention-trees":Array.isArray(a?.trees)?a.trees:[],"seed-trees":Array.isArray(o?.trees)?o.trees:[],smaplantor:Array.isArray(f?.trees)?f.trees:Array.isArray(f)?f:[],hogstubbar:Array.isArray(p?.stubbar)?p.stubbar:[],naturvard:oe(k),kanteffekt:Array.isArray(i?.features)?i.features:[]}},{server:!1,lazy:!0}),t={};D.forEach(a=>{const o=R[a].slug;t[a]={data:j(()=>e.value?.[o]??[]),pending:j(()=>r.value)}});const n=(a,o)=>Z(t[a].data.value,o,R[a]),m=a=>{const o={};return D.forEach(f=>{o[f]=n(f,a)}),o},l=a=>{if(!a?.framework||!a?.time||!a?.startskog)return{...te};const o=m(a);return{retention:t.retention.pending.value||o.retention.length>0,kanteffekt:t.kanteffekt.pending.value||o.kanteffekt.length>0,rottacke:re(a),seedTree:t.seedTree.pending.value||o.seedTree.length>0,smaplantor:t.smaplantor.pending.value||o.smaplantor.length>0,hogstubbar:t.hogstubbar.pending.value||o.hogstubbar.length>0,naturvardsarter:t.naturvardsarter.pending.value||o.naturvardsarter.length>0,tradplantor:ae(a)}},u=j(()=>r.value||D.some(a=>t[a].pending.value));return{datasets:t,filterDataset:n,filterAll:m,availabilityFor:l,pendingAny:u}}const fe={class:"absolute inset-0",style:{"z-index":"0"}},de={class:"flex h-full relative"},ce={class:"absolute text-end right-3 top-2"},me={class:"absolute top-2 left-3"},ye={key:1,class:"flex w-full h-full gap-1"},ge={class:"w-1/2 h-full"},ke={class:"w-1/2 h-full"},pe={__name:"CustomImageComparisonSlider",props:{frameworkLabel:{type:String,default:""},timeLabel:{type:String,default:""},frameworkLabel2:{type:String,default:""},timeLabel2:{type:String,default:""},useMethodLabels:{type:Boolean,default:!1},layoutMode:{type:String,default:"slider"}},setup(e,{expose:r}){q("(max-width: 767px)");const t=e,n=z(t.layoutMode),m=j(()=>t.useMethodLabels?t.frameworkLabel:t.timeLabel),l=j(()=>t.useMethodLabels?t.frameworkLabel2:t.timeLabel2);G(()=>t.layoutMode,s=>{(s==="slider"||s==="side-by-side"||s==="sideBySide")&&(n.value=s)});const u=z(null),a=z(.5);let o=!1;function f(s){if(!u.value)return;const d=u.value.getBoundingClientRect();let S=((s.touches?s.touches[0].clientX:s.clientX)-d.left)/d.width;S=Math.max(0,Math.min(S,1)),a.value=S}function p(s){n.value==="slider"&&(o=!0,f(s),window.addEventListener("mousemove",k),window.addEventListener("mouseup",i),window.addEventListener("touchmove",k),window.addEventListener("touchend",i))}function k(s){o&&f(s)}function i(){o=!1,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",k),window.removeEventListener("touchend",i)}function y(){n.value=n.value==="slider"?"sideBySide":"slider"}function g(s){(s==="slider"||s==="sideBySide")&&(n.value=s)}return r({toggleLayoutMode:y,setLayoutMode:g}),H(()=>{a.value=.5}),(s,d)=>{const h=Y;return n.value==="slider"?(N(),I("div",{key:0,ref_key:"container",ref:u,class:"relative w-full h-full overflow-hidden select-none"},[A("div",fe,[B(s.$slots,"second")]),A("div",{class:"absolute inset-0 overflow-hidden",style:P({clipPath:"inset(0 calc(100% - "+a.value*100+"%) 0 0)",zIndex:10})},[B(s.$slots,"first")],4),A("div",{class:"absolute top-0 flex items-center justify-center h-full w-10 cursor-ew-resize",style:P({left:a.value*100+"%",transform:"translateX(-50%)",zIndex:20}),onMousedown:p,onTouchstart:p},[A("div",de,[A("div",ce,[$(h,{size:"md",class:"backdrop-blur-xl bg-neutral-950/50 text-neutral-100 h-fit whitespace-nowrap"},{default:X(()=>[U(V(m.value),1)]),_:1})]),d[0]||(d[0]=A("div",{class:"h-full w-1.5 bg-neutral-50/90 backdrop-blur-md inset-shadow-sm inset-shadow-neutral-300"},null,-1)),A("div",me,[$(h,{size:"md",class:"backdrop-blur-xl bg-neutral-950/50 text-neutral-100 h-fit whitespace-nowrap"},{default:X(()=>[U(V(l.value),1)]),_:1})])])],36)],512)):n.value==="sideBySide"?(N(),I("div",ye,[A("div",ge,[B(s.$slots,"first")]),A("div",ke,[B(s.$slots,"second")])])):W("",!0)}}};export{ee as D,pe as _,ve as u};
