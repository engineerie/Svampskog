import{aN as G,r as D,K as H,o as Y,d as U,f as C,e as _,h as A,O as M,aX as V,N as K,g as J,P as Q,w as z,ai as B,t as O,aC as Z,aE as ee,W as N}from"#entry";const te={class:"absolute inset-0",style:{"z-index":"0"}},re={class:"flex h-full relative"},ae={class:"absolute text-end right-3 top-2"},se={class:"absolute top-2 left-3"},ne={key:1,class:"flex w-full h-full gap-1"},oe={class:"w-1/2 h-full"},ie={class:"w-1/2 h-full"},be={__name:"CustomImageComparisonSlider",props:{frameworkLabel:{type:String,default:""},timeLabel:{type:String,default:""},frameworkLabel2:{type:String,default:""},timeLabel2:{type:String,default:""},layoutMode:{type:String,default:"slider"}},setup(e,{expose:r}){const t=G("(max-width: 767px)"),o=e,u=D(o.layoutMode);H(()=>o.layoutMode,s=>{(s==="slider"||s==="side-by-side"||s==="sideBySide")&&(u.value=s)});const i=D(null),f=D(.5);let a=!1;function n(s){if(!i.value)return;const l=i.value.getBoundingClientRect();let v=((s.touches?s.touches[0].clientX:s.clientX)-l.left)/l.width;v=Math.max(0,Math.min(v,1)),f.value=v}function c(s){u.value==="slider"&&(a=!0,n(s),window.addEventListener("mousemove",k),window.addEventListener("mouseup",h),window.addEventListener("touchmove",k),window.addEventListener("touchend",h))}function k(s){a&&n(s)}function h(){a=!1,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",k),window.removeEventListener("touchend",h)}function d(){u.value=u.value==="slider"?"sideBySide":"slider"}function y(s){(s==="slider"||s==="sideBySide")&&(u.value=s)}return r({toggleLayoutMode:d,setLayoutMode:y}),Y(()=>{f.value=.5}),(s,l)=>{const m=Z;return u.value==="slider"?(_(),U("div",{key:0,ref_key:"container",ref:i,class:"relative w-full h-full overflow-hidden select-none"},[A("div",te,[M(s.$slots,"second")]),A("div",{class:"absolute inset-0 overflow-hidden",style:V({clipPath:"inset(0 calc(100% - "+f.value*100+"%) 0 0)",zIndex:10})},[M(s.$slots,"first")],4),A("div",{class:"absolute top-0 flex items-center justify-center h-full w-10 cursor-ew-resize",style:V({left:f.value*100+"%",transform:"translateX(-50%)",zIndex:20}),onMousedown:c,onTouchstart:c},[A("div",re,[A("div",ae,[Q(t)?C("",!0):(_(),K(m,{key:0,size:"md",class:"backdrop-blur-xl bg-neutral-100/0 text-neutral-100 h-fit whitespace-nowrap mb-0.5"},{default:z(()=>[B(O(e.frameworkLabel),1)]),_:1})),J(m,{size:"md",class:"backdrop-blur-xl bg-neutral-950/50 text-neutral-100 h-fit whitespace-nowrap"},{default:z(()=>[B(O(e.timeLabel),1)]),_:1})]),l[0]||(l[0]=A("div",{class:"h-full w-1.5 bg-neutral-50/90 backdrop-blur-md inset-shadow-sm inset-shadow-neutral-300"},null,-1)),A("div",se,[Q(t)?C("",!0):(_(),K(m,{key:0,size:"md",class:"backdrop-blur-xl bg-neutral-100/0 text-neutral-100 h-fit whitespace-nowrap mb-0.5"},{default:z(()=>[B(O(e.frameworkLabel2),1)]),_:1})),J(m,{size:"md",class:"backdrop-blur-xl bg-neutral-950/50 text-neutral-100 h-fit whitespace-nowrap"},{default:z(()=>[B(O(e.timeLabel2),1)]),_:1})])])],36)],512)):u.value==="sideBySide"?(_(),U("div",ne,[A("div",oe,[M(s.$slots,"first")]),A("div",ie,[M(s.$slots,"second")])])):C("",!0)}}},I={retention:{slug:"retention-trees",fields:{framework:"framework",startskog:"startskog",time:"time"}},seedTree:{slug:"seed-trees",fields:{framework:"framework",startskog:"startskog",time:"time"}},smaplantor:{slug:"smaplantor",fields:{framework:"framework",startskog:"startskog",time:"time"}},hogstubbar:{slug:"hogstubbar",fields:{framework:"framework",startskog:"startskog",time:"time"}},naturvardsarter:{slug:"naturvard",fields:{framework:"framework",startskog:"startskog",time:"time"}},kanteffekt:{slug:"kanteffekt",fields:{framework:"framework",startskog:null,time:"start"}}},R=Object.keys(I);function L(e){return e?e.replace(/_+$/g,""):e??null}function F(e,r,t=!0){if(!r)return!1;if(e==null)return!0;const o=L(r);return Array.isArray(e)?t&&e.includes("alla")||e.some(u=>L(String(u))===o):typeof e=="string"?t&&e==="alla"?!0:L(e)===o:!1}function W(e,r,t,o={}){const{ignoreStartskog:u=!1}=o,{fields:i}=t;return e.filter(f=>{if(!f)return!1;if(i.framework){const a=f[i.framework];if(!F(a,r.framework,!1))return!1}if(i.startskog&&!u&&r.startskog){const a=f[i.startskog];if(!F(a,r.startskog,!0))return!1}if(i.time){const a=f[i.time];if(!F(a,r.time,!0))return!1}return!0})}function le(e,r,t){if(!Array.isArray(e)||e.length===0)return[];if(!r?.framework||!r?.time)return e;const o={framework:L(r.framework),startskog:L(r.startskog),time:r.time};if(t.slug==="retention-trees"){const f=o.framework,a=o.time;return!f||f==="naturskydd"?[]:!a||a==="innan"?[]:(Array.isArray(e)?e:[]).map(c=>({...c,framework:"alla",startskog:"alla",time:"alla"}))}let i=W(e,o,t);return i.length===0&&t.fields.startskog&&o.startskog&&(i=W(e,o,t,{ignoreStartskog:!0})),i}const ue=["innan","efter","10 år","20 år","50 år","80 år"],fe={retention:!0,kanteffekt:!0,rottacke:!0,seedTree:!0,smaplantor:!0,hogstubbar:!0,naturvardsarter:!0,tradplantor:!0};function de(e){const r=e.framework,t=e.time;if(!r||!t)return!0;const o=r==="skärmträd"||r==="skarmtrad",u=r==="blädning"||r==="bladning",i=o&&t==="efter",f=u&&["efter","20 år","50 år","80 år"].includes(t);return i||f}function ce(e){const r=e.framework,t=e.time;return!r||!t?!0:r==="trakthygge"&&t==="efter"}async function j(e){try{const r=await fetch(encodeURI(e));return r.ok?await r.json():null}catch{return null}}function me(e){switch(e){case"blädning":return["blädning","bladning"];case"skärmträd":return["skärmträd","skarmtrad"];default:return[e]}}function ge(e){if(!e||typeof e!="object")return[];const r=Array.isArray(e.points)?e.points:[],t=new Map;r.length&&r.forEach(d=>{d?.id!=null&&t.set(d.id,d)});const o=e.startskogSets??null,u=e.markers??{},i=e.defaults??{},f=e.frameworks??{},a=Array.isArray(e.timelineOrder)?[...e.timelineOrder]:[...ue],n=new Set(a);Object.values(f).forEach(d=>{!d||typeof d!="object"||Object.values(d).forEach(y=>{Array.isArray(y)&&y.forEach(s=>{const l=s?.time;l&&!n.has(l)&&(n.add(l),a.push(l))})})});const c=a,k=new Map;r.length&&o&&typeof o=="object"?Object.entries(o).forEach(([d,y])=>{const s=new Map;Array.isArray(y)&&y.forEach(l=>{const m=t.get(l);m&&s.set(l,m)}),k.set(d,s)}):Object.entries(u).forEach(([d,y])=>{const s=new Map;Array.isArray(y)&&y.forEach(l=>{l?.id!=null&&s.set(l.id,l)}),k.set(d,s)});const h=[];return Object.entries(f).forEach(([d,y])=>{const s=me(d),l=y??{};k.forEach((m,v)=>{if(!m||m.size===0)return;const P=Array.from(m.keys()),X=Array.isArray(i[v])?i[v]:P;let x=new Set(X),S=new Set;const q=Array.isArray(l[v])?l[v]:[],$=new Map;q.forEach(E=>{E?.time&&$.set(E.time,E)}),c.forEach(E=>{let b=new Set(x);const p=$.get(E);p&&(p.set&&(p.set==="base"?b=new Set(X):p.set==="all"?b=new Set(P):Array.isArray(p.set)&&(b=new Set(p.set))),Array.isArray(p.remove)&&p.remove.forEach(g=>{b.delete(g),S.add(g)}),Array.isArray(p.add)&&p.add.forEach(g=>{b.add(g),S.delete(g)})),x.forEach(g=>{b.has(g)||S.add(g)}),b.forEach(g=>{S.has(g)&&S.delete(g)}),s.forEach(g=>{b.forEach(T=>{const w=m.get(T)||t.get(T);w&&h.push({id:w.id,x:w.x,y:w.y,framework:g,startskog:v,time:E,removed:!1})}),S.forEach(T=>{const w=m.get(T)||t.get(T);w&&h.push({id:w.id,x:w.x,y:w.y,framework:g,startskog:v,time:E,removed:!0})})}),x=new Set(b)})})}),h}function ye(e){return e?Array.isArray(e.mycelium)?e.mycelium:e.markers&&e.frameworks||e.points&&e.startskogSets&&e.frameworks?ge(e):[]:[]}async function ke(){const e=["/småplantor.json","/småplantor.json"];for(const r of e){const t=await j(r);if(t)return t}return null}async function he(){const e=["/seedTrees.json","/overlays/seedTrees.json","/api/seedTrees"];for(const r of e){const t=await j(r);if(t)return t}return null}async function ve(){const e=["/kanteffekt.json","/overlays/kanteffekt.json","/api/kanteffekt"];for(const r of e){const t=await j(r);if(t)return t}return null}function we(){const{data:e,pending:r}=ee("overlay-datasets-json",async()=>{const[a,n,c,k,h,d]=await Promise.all([j("/retentionTrees.json"),he(),ke(),j("/hogstubbar.json"),j("/naturvard.json"),ve()]);return{"retention-trees":Array.isArray(a?.trees)?a.trees:[],"seed-trees":Array.isArray(n?.trees)?n.trees:[],smaplantor:Array.isArray(c?.trees)?c.trees:Array.isArray(c)?c:[],hogstubbar:Array.isArray(k?.stubbar)?k.stubbar:[],naturvard:ye(h),kanteffekt:Array.isArray(d?.features)?d.features:[]}},{server:!1,lazy:!0}),t={};R.forEach(a=>{const n=I[a].slug;t[a]={data:N(()=>e.value?.[n]??[]),pending:N(()=>r.value)}});const o=(a,n)=>le(t[a].data.value,n,I[a]),u=a=>{const n={};return R.forEach(c=>{n[c]=o(c,a)}),n},i=a=>{if(!a?.framework||!a?.time||!a?.startskog)return{...fe};const n=u(a);return{retention:t.retention.pending.value||n.retention.length>0,kanteffekt:t.kanteffekt.pending.value||n.kanteffekt.length>0,rottacke:de(a),seedTree:t.seedTree.pending.value||n.seedTree.length>0,smaplantor:t.smaplantor.pending.value||n.smaplantor.length>0,hogstubbar:t.hogstubbar.pending.value||n.hogstubbar.length>0,naturvardsarter:t.naturvardsarter.pending.value||n.naturvardsarter.length>0,tradplantor:ce(a)}},f=N(()=>r.value||R.some(a=>t[a].pending.value));return{datasets:t,filterDataset:o,filterAll:u,availabilityFor:i,pendingAny:f}}export{ue as D,be as _,we as u};
